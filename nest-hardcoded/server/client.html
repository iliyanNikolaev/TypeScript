<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            background-color: black;
            color: white;
        }
    </style>
</head>

<body>
    <button id="btn">fetch users</button>
    <div id="root"></div>
    <script>
        init();

        function init() {
            const fetchBtn = document.querySelector('#btn');
            const root = document.querySelector('#root');
            fetchBtn.addEventListener('click', renderUsers)
        }

        async function renderUsers(e) {
            e.target.textContent = 'loading...'
            try {
                const users = await getUsers();
                const fragment = document.createDocumentFragment();

                users.forEach(u => {
                    const li = document.createElement('p');
                    li.textContent = ` ${u.username} - ${u.role}`;
                    fragment.appendChild(li);
                });
                root.replaceChildren(fragment);
                e.target.textContent = 'fetch users'
            } catch (err) {
                const errorP = document.createElement('p');
                errorP.textContent = 'error in fetch'
                e.target.textContent = 'try again'
                root.replaceChildren(errorP);
            }

        }

        async function getUsers() {
            const res = await fetch('http://localhost:3000/api/users');
            const users = await res.json();

            return users;
        }
    </script>
</body>

</html>